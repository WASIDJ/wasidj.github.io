<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>通信协议 on Ryou's Blog</title><link>https://www.jeffkafka.top/categories/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/</link><description>Recent content in 通信协议 on Ryou's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 09 Feb 2026 20:15:42 +0800</lastBuildDate><atom:link href="https://www.jeffkafka.top/categories/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/index.xml" rel="self" type="application/rss+xml"/><item><title>grpc stream传输方式</title><link>https://www.jeffkafka.top/post/grpc-stream%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F/</link><pubDate>Mon, 09 Feb 2026 20:15:42 +0800</pubDate><guid>https://www.jeffkafka.top/post/grpc-stream%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F/</guid><description>&lt;img src="https://w.wallhaven.cc/full/qr/wallhaven-qrj31d.jpg" alt="Featured image of post grpc stream传输方式" /&gt;&lt;h1 id="grpc-四种-stream-传输方式详解"&gt;gRPC 四种 Stream 传输方式详解
&lt;/h1&gt;&lt;h2 id="1-背景与定义"&gt;1. 背景与定义
&lt;/h2&gt;&lt;p&gt;gRPC 是 Google 开源的高性能 RPC 框架，基于 &lt;strong&gt;HTTP/2&lt;/strong&gt; 协议和 &lt;strong&gt;Protocol Buffers&lt;/strong&gt; 序列化。其核心优势之一就是支持四种不同的通信模式，满足各种业务场景需求。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;HTTP/2 的多路复用和流控机制是 gRPC Stream 的底层支撑。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;参考定义：&lt;a class="link" href="https://grpc.io/docs/what-is-grpc/core-concepts/" target="_blank" rel="noopener"
&gt;gRPC 官方文档 – Concepts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="2-四种传输模式概览"&gt;2. 四种传输模式概览
&lt;/h2&gt;&lt;pre class="mermaid"&gt;
flowchart TB
subgraph Modes["gRPC 四种通信模式"]
A["1.Unary RPC&lt;br/&gt;一元调用"]
B["2.Server Streaming RPC&lt;br/&gt;服务端流"]
C["3.Client Streaming RPC&lt;br/&gt;客户端流"]
D["4.Bidirectional Streaming RPC&lt;br/&gt;双向流"]
end
A --&gt; E{"选择依据"}
E --&gt; |简单请求响应| A
E --&gt; |服务端推送大量数据| B
E --&gt; |客户端上传大量数据| C
E --&gt; |实时双向通信| D
&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="3-详细解析"&gt;3. 详细解析
&lt;/h2&gt;&lt;h3 id="31-unary-rpc一元调用"&gt;3.1 Unary RPC（一元调用）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;定义&lt;/strong&gt;：最传统的模式，客户端发送&lt;strong&gt;一个请求&lt;/strong&gt;，服务端返回&lt;strong&gt;一个响应&lt;/strong&gt;。&lt;/p&gt;
&lt;pre class="mermaid"&gt;
sequenceDiagram
participant C as Client
participant S as Server
C-&gt;&gt;S: Request (单个消息)
S-&gt;&gt;C: Response (单个消息)
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;特点&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;类似传统 HTTP REST API&lt;/li&gt;
&lt;li&gt;同步阻塞或异步调用&lt;/li&gt;
&lt;li&gt;最简单、最常用&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Proto 定义示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; GetUser(GetUserRequest) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (UserResponse);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;适用场景&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;简单的 CRUD 操作&lt;/li&gt;
&lt;li&gt;请求数据量小、响应快速的场景&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="32-server-streaming-rpc服务端流式-rpc"&gt;3.2 Server Streaming RPC（服务端流式 RPC）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;定义&lt;/strong&gt;：客户端发送&lt;strong&gt;一个请求&lt;/strong&gt;，服务端返回&lt;strong&gt;一个消息流&lt;/strong&gt;（多个响应）。&lt;/p&gt;
&lt;pre class="mermaid"&gt;
sequenceDiagram
participant C as Client
participant S as Server
C-&gt;&gt;S: Request (单个消息)
S-&gt;&gt;C: Response 1
S-&gt;&gt;C: Response 2
S-&gt;&gt;C: Response 3
S-&gt;&gt;C: ...
Note over S,C: 服务端持续推送直到结束
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;特点&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务端可以分批发送大量数据&lt;/li&gt;
&lt;li&gt;客户端按顺序读取流&lt;/li&gt;
&lt;li&gt;利用 HTTP/2 流控避免拥塞&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Proto 定义示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; ListFeatures(Rectangle) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (stream Feature);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;适用场景&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大数据集分批返回（如日志查询、历史记录）&lt;/li&gt;
&lt;li&gt;服务端实时推送（如股票行情、通知推送）&lt;/li&gt;
&lt;li&gt;文件下载&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;代码示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-go" data-lang="go"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// Server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;func&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;s&lt;/span&gt; &lt;span style="color:#f92672"&gt;*&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;server&lt;/span&gt;) &lt;span style="color:#a6e22e"&gt;ListFeatures&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;req&lt;/span&gt; &lt;span style="color:#f92672"&gt;*&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;pb&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Rectangle&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;pb&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;RouteGuide_ListFeaturesServer&lt;/span&gt;) &lt;span style="color:#66d9ef"&gt;error&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;feature&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;range&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;features&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;inRange&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;feature&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Location&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;req&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Send&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;feature&lt;/span&gt;) &lt;span style="color:#75715e"&gt;// 逐个发送&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// Client&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;client&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;ListFeatures&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;ctx&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;rect&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;feature&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;err&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Recv&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;err&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;io&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;EOF&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;break&lt;/span&gt; &lt;span style="color:#75715e"&gt;// 流结束&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// 处理 feature&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="33-client-streaming-rpc客户端流式-rpc"&gt;3.3 Client Streaming RPC（客户端流式 RPC）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;定义&lt;/strong&gt;：客户端发送&lt;strong&gt;一个消息流&lt;/strong&gt;，服务端返回&lt;strong&gt;一个响应&lt;/strong&gt;。&lt;/p&gt;
&lt;pre class="mermaid"&gt;
sequenceDiagram
participant C as Client
participant S as Server
C-&gt;&gt;S: Message 1
C-&gt;&gt;S: Message 2
C-&gt;&gt;S: Message 3
C-&gt;&gt;S: ...
Note over C,S: 客户端发送完毕
S-&gt;&gt;C: Response (单个汇总响应)
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;特点&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;客户端可以分批上传数据&lt;/li&gt;
&lt;li&gt;服务端在收到所有数据后处理并返回结果&lt;/li&gt;
&lt;li&gt;适合大数据上传场景&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Proto 定义示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; RecordRoute(stream Point) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (RouteSummary);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;适用场景&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;文件上传&lt;/li&gt;
&lt;li&gt;批量数据提交&lt;/li&gt;
&lt;li&gt;聚合计算（如上传多个数据点，返回统计结果）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;代码示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-go" data-lang="go"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// Client&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;client&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;RecordRoute&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;ctx&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;point&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;range&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;points&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Send&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;point&lt;/span&gt;) &lt;span style="color:#75715e"&gt;// 逐个发送&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;summary&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;CloseAndRecv&lt;/span&gt;() &lt;span style="color:#75715e"&gt;// 关闭流并接收响应&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// Server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;func&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;s&lt;/span&gt; &lt;span style="color:#f92672"&gt;*&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;server&lt;/span&gt;) &lt;span style="color:#a6e22e"&gt;RecordRoute&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;pb&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;RouteGuide_RecordRouteServer&lt;/span&gt;) &lt;span style="color:#66d9ef"&gt;error&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;var&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;pointCount&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;point&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;err&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Recv&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;err&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;io&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;EOF&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;SendAndClose&lt;/span&gt;(&lt;span style="color:#f92672"&gt;&amp;amp;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;pb&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;RouteSummary&lt;/span&gt;{&lt;span style="color:#a6e22e"&gt;PointCount&lt;/span&gt;: &lt;span style="color:#a6e22e"&gt;pointCount&lt;/span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;pointCount&lt;/span&gt;&lt;span style="color:#f92672"&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h3 id="34-bidirectional-streaming-rpc双向流式-rpc"&gt;3.4 Bidirectional Streaming RPC（双向流式 RPC）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;定义&lt;/strong&gt;：客户端和服务端&lt;strong&gt;同时&lt;/strong&gt;发送消息流，两个流独立运行。&lt;/p&gt;
&lt;pre class="mermaid"&gt;
sequenceDiagram
participant C as Client
participant S as Server
C-&gt;&gt;S: Message 1
S-&gt;&gt;C: Response 1
C-&gt;&gt;S: Message 2
S-&gt;&gt;C: Response 2
C-&gt;&gt;S: Message 3
Note over C,S: 两个流独立，顺序不要求一一对应
S-&gt;&gt;C: Response 3
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;特点&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;全双工通信&lt;/li&gt;
&lt;li&gt;两个流相互独立，可以交错发送&lt;/li&gt;
&lt;li&gt;最灵活但也最复杂&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Proto 定义示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; RouteChat(stream RouteNote) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (stream RouteNote);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;适用场景&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;实时聊天应用&lt;/li&gt;
&lt;li&gt;多人游戏同步&lt;/li&gt;
&lt;li&gt;实时协作编辑&lt;/li&gt;
&lt;li&gt;IoT 设备双向通信&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;代码示例&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-go" data-lang="go"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// Client&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;client&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;RouteChat&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;ctx&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;waitc&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; make(&lt;span style="color:#66d9ef"&gt;chan&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;struct&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 接收协程&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;go&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;func&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;note&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;err&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Recv&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;err&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;io&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;EOF&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; close(&lt;span style="color:#a6e22e"&gt;waitc&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// 处理收到的消息&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 发送&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;note&lt;/span&gt; &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;range&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;notes&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;Send&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;note&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;stream&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;CloseSend&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;&amp;lt;-&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;waitc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="4-四种模式对比"&gt;4. 四种模式对比
&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;特性&lt;/th&gt;
&lt;th&gt;Unary&lt;/th&gt;
&lt;th&gt;Server Streaming&lt;/th&gt;
&lt;th&gt;Client Streaming&lt;/th&gt;
&lt;th&gt;Bidirectional Streaming&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;请求数量&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;N (流)&lt;/td&gt;
&lt;td&gt;N (流)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;响应数量&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;N (流)&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;N (流)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;通信方向&lt;/td&gt;
&lt;td&gt;单向&lt;/td&gt;
&lt;td&gt;单向 →&lt;/td&gt;
&lt;td&gt;单向 ←&lt;/td&gt;
&lt;td&gt;双向 ↔&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;复杂度&lt;/td&gt;
&lt;td&gt;低&lt;/td&gt;
&lt;td&gt;中&lt;/td&gt;
&lt;td&gt;中&lt;/td&gt;
&lt;td&gt;高&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;典型场景&lt;/td&gt;
&lt;td&gt;CRUD&lt;/td&gt;
&lt;td&gt;推送/下载&lt;/td&gt;
&lt;td&gt;上传/聚合&lt;/td&gt;
&lt;td&gt;实时通信&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="5-底层原理http2-stream"&gt;5. 底层原理：HTTP/2 Stream
&lt;/h2&gt;&lt;p&gt;gRPC 的流式传输依赖 HTTP/2 的特性：&lt;/p&gt;
&lt;pre class="mermaid"&gt;
flowchart LR
subgraph HTTP2["HTTP/2 特性"]
A["多路复用&lt;br/&gt;Multiplexing"]
B["流控&lt;br/&gt;Flow Control"]
C["头部压缩&lt;br/&gt;HPACK"]
D["双向流&lt;br/&gt;Bidirectional"]
end
A --&gt; E["单 TCP 连接多请求"]
B --&gt; F["避免拥塞"]
C --&gt; G["减少开销"]
D --&gt; H["支持双向流 RPC"]
&lt;/pre&gt;
&lt;p&gt;每个 gRPC Stream 对应一个 HTTP/2 Stream，通过 &lt;strong&gt;Stream ID&lt;/strong&gt; 标识，可以在同一 TCP 连接上并行传输。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="6-最佳实践与注意事项"&gt;6. 最佳实践与注意事项
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;流控管理&lt;/strong&gt;：注意 HTTP/2 默认流控窗口，大数据传输时可能需要调整&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误处理&lt;/strong&gt;：流式调用需要正确处理 &lt;code&gt;io.EOF&lt;/code&gt; 和其他错误&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;超时设置&lt;/strong&gt;：长时间运行的流需要合理设置 Deadline&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;资源释放&lt;/strong&gt;：确保流正确关闭，避免资源泄漏&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;顺序保证&lt;/strong&gt;：单个流内消息顺序保证，但多个流之间无序&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id="7-参考链接"&gt;7. 参考链接
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a class="link" href="https://grpc.io/docs/what-is-grpc/core-concepts/" target="_blank" rel="noopener"
&gt;gRPC 官方文档 – Core Concepts&lt;/a&gt; — gRPC 官方核心概念说明&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://grpc.io/docs/guides/performance/" target="_blank" rel="noopener"
&gt;gRPC 官方 – Streaming Best Practices&lt;/a&gt; — 性能与最佳实践指南&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://protobuf.dev/programming-guides/" target="_blank" rel="noopener"
&gt;Protocol Buffers 官方文档&lt;/a&gt; — Proto3 语法参考&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://datatracker.ietf.org/doc/html/rfc7540" target="_blank" rel="noopener"
&gt;HTTP/2 RFC 7540&lt;/a&gt; — HTTP/2 协议规范&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/grpc/grpc" target="_blank" rel="noopener"
&gt;gRPC GitHub 仓库&lt;/a&gt; — 源码与示例&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>grpc常见的protoc命令行</title><link>https://www.jeffkafka.top/post/golang%E4%B8%ADgrpc%E5%B8%B8%E8%A7%81%E7%9A%84protoc%E5%91%BD%E4%BB%A4%E8%A1%8C/</link><pubDate>Mon, 09 Feb 2026 19:44:59 +0800</pubDate><guid>https://www.jeffkafka.top/post/golang%E4%B8%ADgrpc%E5%B8%B8%E8%A7%81%E7%9A%84protoc%E5%91%BD%E4%BB%A4%E8%A1%8C/</guid><description>&lt;img src="https://w.wallhaven.cc/full/og/wallhaven-ogy6zm.jpg" alt="Featured image of post grpc常见的protoc命令行" /&gt;&lt;h1 id="grpc-中常见的-protoc-命令行参数详解"&gt;gRPC 中常见的 protoc 命令行参数详解
&lt;/h1&gt;&lt;h2 id="1-背景与概述"&gt;1. 背景与概述
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;protoc&lt;/code&gt; 是 Protocol Buffers 的编译器，用于将 &lt;code&gt;.proto&lt;/code&gt; 文件编译生成各种语言的代码。在 Go 语言中使用 gRPC 时，需要配合 &lt;code&gt;protoc-gen-go&lt;/code&gt; 和 &lt;code&gt;protoc-gen-go-grpc&lt;/code&gt; 插件来生成代码。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;官方文档：&lt;a class="link" href="https://protobuf.dev/" target="_blank" rel="noopener"
&gt;Protocol Buffers - Google Developers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;gRPC Go 快速开始：&lt;a class="link" href="https://grpc.io/docs/languages/go/quickstart/" target="_blank" rel="noopener"
&gt;gRPC Quick Start - Go&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="2-protoc-命令基本结构"&gt;2. protoc 命令基本结构
&lt;/h2&gt;&lt;pre class="mermaid"&gt;
flowchart LR
A[".proto 文件"] --&gt; B["protoc 编译器"]
B --&gt; C["protoc-gen-go 插件"]
B --&gt; D["protoc-gen-go-grpc 插件"]
C --&gt; E["*.pb.go&lt;br/&gt;消息类型代码"]
D --&gt; F["*_grpc.pb.go&lt;br/&gt;gRPC 服务代码"]
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;基本命令格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc &lt;span style="color:#f92672"&gt;[&lt;/span&gt;OPTIONS&lt;span style="color:#f92672"&gt;]&lt;/span&gt; FILE.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="3-核心参数详解"&gt;3. 核心参数详解
&lt;/h2&gt;&lt;h3 id="31-输入输出相关参数"&gt;3.1 输入输出相关参数
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;--proto_path=PATH&lt;/code&gt; / &lt;code&gt;-I PATH&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;指定 &lt;code&gt;.proto&lt;/code&gt; 文件的搜索路径（可多次指定）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;--go_out=PATH&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Go 消息类型代码的输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;--go-grpc_out=PATH&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;gRPC 服务端/客户端代码的输出目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;--descriptor_set_out=FILE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;输出 &lt;code&gt;FileDescriptorSet&lt;/code&gt; 到指定文件&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-h&lt;/code&gt; / &lt;code&gt;--help&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示帮助信息&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="32-go-插件专用参数"&gt;3.2 Go 插件专用参数
&lt;/h3&gt;&lt;p&gt;通过 &lt;code&gt;--go_opt&lt;/code&gt; 和 &lt;code&gt;--go-grpc_opt&lt;/code&gt; 传递：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;paths=source_relative&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;输出文件路径相对于 &lt;code&gt;.proto&lt;/code&gt; 源文件（而非 go_package）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;module=example.com/module&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;指定模块前缀，输出路径会去掉此前缀&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;M=foo.proto=example.com/bar&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;覆盖特定 &lt;code&gt;.proto&lt;/code&gt; 文件的 Go 包路径映射&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="33-descriptor-相关参数"&gt;3.3 descriptor 相关参数
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;--include_imports&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;在 descriptor set 中包含所有导入的文件&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;--include_source_info&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;包含源代码位置信息（用于调试、文档生成等）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="4-常用命令示例"&gt;4. 常用命令示例
&lt;/h2&gt;&lt;h3 id="41-最简命令单文件"&gt;4.1 最简命令（单文件）
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc --go_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. --go-grpc_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. hello.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="42-指定搜索路径与输出目录"&gt;4.2 指定搜索路径与输出目录
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -I&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./proto &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./output &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go-grpc_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./output &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ./proto/hello.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="43-使用-pathssource_relative"&gt;4.3 使用 &lt;code&gt;paths=source_relative&lt;/code&gt;
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. --go_opt&lt;span style="color:#f92672"&gt;=&lt;/span&gt;paths&lt;span style="color:#f92672"&gt;=&lt;/span&gt;source_relative &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go-grpc_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. --go-grpc_opt&lt;span style="color:#f92672"&gt;=&lt;/span&gt;paths&lt;span style="color:#f92672"&gt;=&lt;/span&gt;source_relative &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; hello.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;这样生成的 &lt;code&gt;hello.pb.go&lt;/code&gt; 会直接在当前目录，而不是按 &lt;code&gt;go_package&lt;/code&gt; 路径创建子目录。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="44-批量编译使用-find"&gt;4.4 批量编译（使用 find）
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;find ./proto -name &lt;span style="color:#e6db74"&gt;&amp;#34;*.proto&amp;#34;&lt;/span&gt; | xargs protoc &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -I&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./proto &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./output --go_opt&lt;span style="color:#f92672"&gt;=&lt;/span&gt;paths&lt;span style="color:#f92672"&gt;=&lt;/span&gt;source_relative &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go-grpc_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./output --go-grpc_opt&lt;span style="color:#f92672"&gt;=&lt;/span&gt;paths&lt;span style="color:#f92672"&gt;=&lt;/span&gt;source_relative
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="45-生成-filedescriptorset用于反射网关等"&gt;4.5 生成 FileDescriptorSet（用于反射、网关等）
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -I&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./proto &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --include_imports &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --include_source_info &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --descriptor_set_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;./output/hello.pb &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ./proto/hello.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="5-参数传递流程图"&gt;5. 参数传递流程图
&lt;/h2&gt;&lt;pre class="mermaid"&gt;
flowchart TD
subgraph 输入
P[".proto 文件"]
end
subgraph "protoc 编译器"
I["-I / --proto_path&lt;br/&gt;指定搜索路径"]
end
subgraph "Go 插件"
GO["--go_out&lt;br/&gt;--go_opt"]
OPT1["paths=source_relative"]
OPT2["module=..."]
OPT3["M=..."]
end
subgraph "gRPC 插件"
GRPC["--go-grpc_out&lt;br/&gt;--go-grpc_opt"]
OPT4["paths=source_relative"]
end
P --&gt; I
I --&gt; GO
I --&gt; GRPC
GO --&gt; OPT1
GO --&gt; OPT2
GO --&gt; OPT3
GRPC --&gt; OPT4
&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="6-proto-文件中的关键声明"&gt;6. .proto 文件中的关键声明
&lt;/h2&gt;&lt;p&gt;在 &lt;code&gt;.proto&lt;/code&gt; 文件中，以下声明会影响生成代码的包路径：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;syntax &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;package&lt;/span&gt; myservice; &lt;span style="color:#75715e"&gt;// 逻辑包名
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;option&lt;/span&gt; go_package &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;example.com/myservice&amp;#34;&lt;/span&gt;; &lt;span style="color:#75715e"&gt;// Go 包导入路径
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;go_package&lt;/code&gt; 决定了生成代码的 Go import 路径&lt;/li&gt;
&lt;li&gt;若未设置 &lt;code&gt;paths=source_relative&lt;/code&gt;，输出目录会按 &lt;code&gt;go_package&lt;/code&gt; 创建&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="7-常见问题与解决方案"&gt;7. 常见问题与解决方案
&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;问题&lt;/th&gt;
&lt;th&gt;原因&lt;/th&gt;
&lt;th&gt;解决方案&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;protoc-gen-go: program not found&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;未安装插件&lt;/td&gt;
&lt;td&gt;&lt;code&gt;go install google.golang.org/protobuf/cmd/protoc-gen-go@latest&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;protoc-gen-go-grpc: program not found&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;未安装 gRPC 插件&lt;/td&gt;
&lt;td&gt;&lt;code&gt;go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;输出目录层级混乱&lt;/td&gt;
&lt;td&gt;&lt;code&gt;go_package&lt;/code&gt; 与 &lt;code&gt;--go_out&lt;/code&gt; 配合不当&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;paths=source_relative&lt;/code&gt; 或调整 &lt;code&gt;go_package&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;import 路径错误&lt;/td&gt;
&lt;td&gt;多 proto 文件包映射问题&lt;/td&gt;
&lt;td&gt;使用 &lt;code&gt;M&lt;/code&gt; 参数显式指定映射&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="8-完整-makefile-示例"&gt;8. 完整 Makefile 示例
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-makefile" data-lang="makefile"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;.PHONY&lt;/span&gt;&lt;span style="color:#f92672"&gt;:&lt;/span&gt; proto
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;PROTO_DIR &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; ./proto
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;OUTPUT_DIR &lt;span style="color:#f92672"&gt;:=&lt;/span&gt; ./internal/pb
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#a6e22e"&gt;proto&lt;/span&gt;&lt;span style="color:#f92672"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; protoc &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; -I&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;PROTO_DIR&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;OUTPUT_DIR&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt; --go_opt&lt;span style="color:#f92672"&gt;=&lt;/span&gt;paths&lt;span style="color:#f92672"&gt;=&lt;/span&gt;source_relative &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; --go-grpc_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;OUTPUT_DIR&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt; --go-grpc_opt&lt;span style="color:#f92672"&gt;=&lt;/span&gt;paths&lt;span style="color:#f92672"&gt;=&lt;/span&gt;source_relative &lt;span style="color:#ae81ff"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;PROTO_DIR&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;/**/*.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="9-参考链接"&gt;9. 参考链接
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a class="link" href="https://protobuf.dev/" target="_blank" rel="noopener"
&gt;Protocol Buffers 官方文档&lt;/a&gt; — Google 官方 Protobuf 文档&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://grpc.io/docs/languages/go/quickstart/" target="_blank" rel="noopener"
&gt;gRPC Go Quick Start&lt;/a&gt; — gRPC 官方 Go 快速入门&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/protocolbuffers/protobuf-go" target="_blank" rel="noopener"
&gt;protoc-gen-go GitHub&lt;/a&gt; — Go Protobuf 运行时与编译器插件&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/grpc/grpc-go" target="_blank" rel="noopener"
&gt;protoc-gen-go-grpc GitHub&lt;/a&gt; — gRPC Go 官方仓库&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://buf.build/" target="_blank" rel="noopener"
&gt;Buf CLI&lt;/a&gt; — 现代化的 Protobuf 工具链（可作为 protoc 替代方案）&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;div class="admonition tip"&gt;
&lt;div class="admonition-header"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"&gt;&lt;path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/&gt;&lt;/svg&gt;
&lt;span&gt;提示&lt;/span&gt;
&lt;/div&gt;
&lt;div class="admonition-content"&gt;
&lt;p&gt;如果你使用较新版本的 &lt;code&gt;protoc-gen-go&lt;/code&gt;（v1.20+），建议配合 &lt;code&gt;google.golang.org/grpc/cmd/protoc-gen-go-grpc&lt;/code&gt; 使用，旧版 &lt;code&gt;github.com/golang/protobuf&lt;/code&gt; 已不再维护。&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>grpc</title><link>https://www.jeffkafka.top/post/grpc/</link><pubDate>Tue, 03 Feb 2026 13:11:24 +0800</pubDate><guid>https://www.jeffkafka.top/post/grpc/</guid><description>&lt;img src="https://w.wallhaven.cc/full/po/wallhaven-polllj.jpg" alt="Featured image of post grpc" /&gt;&lt;h1 id="grpc-详解"&gt;gRPC 详解
&lt;/h1&gt;&lt;h2 id="1-背景与定义"&gt;1. 背景与定义
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;gRPC&lt;/strong&gt; (gRPC Remote Procedure Calls) 是 Google 于 2015 年开源的高性能、通用的 &lt;strong&gt;RPC (远程过程调用)&lt;/strong&gt; 框架。它基于 &lt;strong&gt;HTTP/2&lt;/strong&gt; 协议传输，使用 &lt;strong&gt;Protocol Buffers&lt;/strong&gt; 作为接口定义语言 (IDL) 和序列化格式。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;官方定义：gRPC 是一个高性能、开源和通用的 RPC 框架，面向移动和 HTTP/2 设计。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;官方网站：&lt;a class="link" href="https://grpc.io/" target="_blank" rel="noopener"
&gt;gRPC - A high performance, open source universal RPC framework&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;GitHub 仓库：&lt;a class="link" href="https://github.com/grpc/grpc" target="_blank" rel="noopener"
&gt;grpc/grpc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="2-核心概念与架构"&gt;2. 核心概念与架构
&lt;/h2&gt;&lt;h3 id="21-核心组件"&gt;2.1 核心组件
&lt;/h3&gt;&lt;pre class="mermaid"&gt;
flowchart TB
subgraph Client["客户端"]
C1["Client Stub&lt;br/&gt;(生成的代码)"]
C2["序列化"]
C3["HTTP/2 客户端"]
end
subgraph Server["服务端"]
S1["HTTP/2 服务端"]
S2["反序列化"]
S3["Server Skeleton&lt;br/&gt;(生成的代码)"]
S4["服务实现"]
end
subgraph Proto["接口定义"]
P1[".proto 文件"]
end
P1 --&gt;|"protoc 编译器"| C1
P1 --&gt;|"protoc 编译器"| S3
C1 --&gt; C2 --&gt; C3
C3 --&gt;|"HTTP/2 + Protobuf"| S1
S1 --&gt; S2 --&gt; S3 --&gt; S4
&lt;/pre&gt;
&lt;h3 id="22-关键技术栈"&gt;2.2 关键技术栈
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;HTTP/2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;二进制分帧、多路复用、头部压缩、服务端推送&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Protocol Buffers&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;高效的二进制序列化格式，比 JSON 更小更快&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;gRPC Stub&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;由 protoc 生成的客户端/服务端代码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Channel&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;到 gRPC 服务端的连接抽象&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Call&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;单次 RPC 调用的抽象&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="3-四种通信模式"&gt;3. 四种通信模式
&lt;/h2&gt;&lt;p&gt;gRPC 支持四种通信模式，充分利用 HTTP/2 的双向流能力：&lt;/p&gt;
&lt;pre class="mermaid"&gt;
flowchart LR
subgraph Modes["gRPC 四种通信模式"]
direction TB
M1["1.Unary RPC&lt;br/&gt;一元调用"]
M2["2.Server Streaming&lt;br/&gt;服务端流"]
M3["3.Client Streaming&lt;br/&gt;客户端流"]
M4["4.Bidirectional Streaming&lt;br/&gt;双向流"]
end
M1 --&gt; D1["请求 → 响应&lt;br/&gt;(1:1)"]
M2 --&gt; D2["请求 → 流响应&lt;br/&gt;(1:N)"]
M3 --&gt; D3["流请求 → 响应&lt;br/&gt;(N:1)"]
M4 --&gt; D4["流请求 ↔ 流响应&lt;br/&gt;(N:M)"]
&lt;/pre&gt;
&lt;h3 id="31-模式详解"&gt;3.1 模式详解
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 1. Unary RPC - 传统请求响应
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; GetUser(GetUserRequest) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (User);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 2. Server Streaming - 服务端流式响应
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; ListUsers(ListUsersRequest) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (stream User);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 3. Client Streaming - 客户端流式请求
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; UploadFile(stream FileChunk) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (UploadResponse);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 4. Bidirectional Streaming - 双向流
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; Chat(stream Message) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (stream Message);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="4-工作流程"&gt;4. 工作流程
&lt;/h2&gt;&lt;pre class="mermaid"&gt;
sequenceDiagram
participant Dev as 开发者
participant Proto as .proto 文件
participant Compiler as protoc 编译器
participant Client as 客户端
participant Network as 网络 (HTTP/2)
participant Server as 服务端
Dev-&gt;&gt;Proto: 1. 定义服务接口
Proto-&gt;&gt;Compiler: 2. 编译 .proto
Compiler-&gt;&gt;Client: 3. 生成 Client Stub
Compiler-&gt;&gt;Server: 4. 生成 Server Skeleton
Client-&gt;&gt;Client: 5. 调用 Stub 方法
Client-&gt;&gt;Client: 6. 序列化
Client-&gt;&gt;Network: 7. HTTP/2 请求
Network-&gt;&gt;Server: 8. 传输二进制数据
Server-&gt;&gt;Server: 9. 反序列化
Server-&gt;&gt;Server: 10. 执行服务方法
Server-&gt;&gt;Network: 11. HTTP/2 响应
Network-&gt;&gt;Client: 12. 返回结果
Client-&gt;&gt;Client: 13. 反序列化
Client-&gt;&gt;Dev: 14. 返回响应对象
&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="5-protocol-buffers-示例"&gt;5. Protocol Buffers 示例
&lt;/h2&gt;&lt;h3 id="51-定义-proto-文件"&gt;5.1 定义 Proto 文件
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-protobuf" data-lang="protobuf"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// user.proto
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;syntax &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;proto3&amp;#34;&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;package&lt;/span&gt; user;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;option&lt;/span&gt; go_package &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;./pb&amp;#34;&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 服务定义
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;service&lt;/span&gt; UserService {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// Unary RPC
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; GetUser(GetUserRequest) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (User);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// Server Streaming
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; ListUsers(ListUsersRequest) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (stream User);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// Client Streaming
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; CreateUsers(stream CreateUserRequest) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (CreateUsersResponse);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// Bidirectional Streaming
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;rpc&lt;/span&gt; Chat(stream ChatMessage) &lt;span style="color:#66d9ef"&gt;returns&lt;/span&gt; (stream ChatMessage);&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;// 消息定义
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;message&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;User&lt;/span&gt; {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; id &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; email &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;3&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;repeated&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; roles &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;4&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;message&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;GetUserRequest&lt;/span&gt; {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; id &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;message&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ListUsersRequest&lt;/span&gt; {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; page &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; page_size &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;message&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CreateUserRequest&lt;/span&gt; {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; email &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;message&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CreateUsersResponse&lt;/span&gt; {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;repeated&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; ids &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; total &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;message&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ChatMessage&lt;/span&gt; {&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int32&lt;/span&gt; user_id &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;string&lt;/span&gt; content &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;int64&lt;/span&gt; timestamp &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;3&lt;/span&gt;;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="52-生成代码"&gt;5.2 生成代码
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Go 语言&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc --go_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. --go-grpc_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. user.proto
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Java&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;protoc --java_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. --grpc-java_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. user.proto
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# Python&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;python -m grpc_tools.protoc -I. --python_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. --grpc_python_out&lt;span style="color:#f92672"&gt;=&lt;/span&gt;. user.proto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="6-grpc-vs-rest-对比"&gt;6. gRPC vs REST 对比
&lt;/h2&gt;&lt;pre class="mermaid"&gt;
flowchart LR
subgraph REST["REST API"]
R1["HTTP/1.1"]
R2["JSON/XML"]
R3["文本传输"]
R4["请求-响应"]
end
subgraph gRPC["gRPC"]
G1["HTTP/2"]
G2["Protocol Buffers"]
G3["二进制传输"]
G4["四种流模式"]
end
REST --&gt; |"性能较低"| gRPC
&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;特性&lt;/th&gt;
&lt;th&gt;gRPC&lt;/th&gt;
&lt;th&gt;REST&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;协议&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;HTTP/2&lt;/td&gt;
&lt;td&gt;HTTP/1.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;数据格式&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Protocol Buffers (二进制)&lt;/td&gt;
&lt;td&gt;JSON/XML (文本)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;性能&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;高 (二进制 + 头部压缩)&lt;/td&gt;
&lt;td&gt;较低&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;流式传输&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;✅ 支持 4 种模式&lt;/td&gt;
&lt;td&gt;❌ 仅请求-响应&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;代码生成&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;✅ 自动生成强类型 Stub&lt;/td&gt;
&lt;td&gt;❌ 需手动或第三方工具&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;浏览器支持&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;❌ 需要 gRPC-Web 代理&lt;/td&gt;
&lt;td&gt;✅ 原生支持&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;调试难度&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;较高 (二进制不可读)&lt;/td&gt;
&lt;td&gt;低 (文本可读)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;学习曲线&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;较陡&lt;/td&gt;
&lt;td&gt;平缓&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="7-多语言支持"&gt;7. 多语言支持
&lt;/h2&gt;&lt;p&gt;gRPC 官方支持多种编程语言：&lt;/p&gt;
&lt;pre class="mermaid"&gt;
mindmap
root((gRPC))
官方支持
Go
Java
C/C++
Python
Ruby
C#
Node.js
Android Java
Objective-C
PHP
Dart
第三方支持
Rust
Swift
Scala
Elixir
Haskell
&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="8-实际应用场景"&gt;8. 实际应用场景
&lt;/h2&gt;&lt;h3 id="81-适用场景"&gt;8.1 适用场景
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;微服务架构&lt;/strong&gt;：服务间高性能通信&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实时通信&lt;/strong&gt;：聊天应用、实时数据推送&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;物联网&lt;/strong&gt;：低带宽、高效率的数据传输&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;移动应用&lt;/strong&gt;：减少网络流量和延迟&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;大数据传输&lt;/strong&gt;：流式上传/下载&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="82-架构示例"&gt;8.2 架构示例
&lt;/h3&gt;&lt;pre class="mermaid"&gt;
flowchart TB
subgraph Frontend["前端"]
Web["Web App&lt;br/&gt;(gRPC-Web)"]
Mobile["Mobile App&lt;br/&gt;(gRPC Native)"]
end
subgraph Gateway["API Gateway"]
GW["Envoy/Nginx&lt;br/&gt;gRPC-Web 代理"]
end
subgraph Backend["后端微服务"]
S1["User Service&lt;br/&gt;(Go)"]
S2["Order Service&lt;br/&gt;(Java)"]
S3["Payment Service&lt;br/&gt;(Python)"]
S4["Notification Service&lt;br/&gt;(Node.js)"]
end
subgraph DB["数据层"]
D1[("PostgreSQL")]
D2[("Redis")]
D3[("Kafka")]
end
Web --&gt; GW
Mobile --&gt; S1
GW --&gt; S1
GW --&gt; S2
S1 &lt;--&gt;|"gRPC"| S2
S2 &lt;--&gt;|"gRPC"| S3
S3 &lt;--&gt;|"gRPC"| S4
S1 --&gt; D1
S2 --&gt; D1
S3 --&gt; D2
S4 --&gt; D3
&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="9-优缺点总结"&gt;9. 优缺点总结
&lt;/h2&gt;&lt;h3 id="91-优点"&gt;9.1 优点
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;✅ &lt;strong&gt;高性能&lt;/strong&gt;：二进制序列化 + HTTP/2 多路复用&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;强类型&lt;/strong&gt;：通过 .proto 自动生成代码，减少运行时错误&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;双向流&lt;/strong&gt;：支持实时通信场景&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;多语言&lt;/strong&gt;：官方支持 10+ 种语言&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;内置功能&lt;/strong&gt;：超时、取消、元数据、认证、负载均衡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="92-缺点"&gt;9.2 缺点
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;❌ &lt;strong&gt;浏览器支持有限&lt;/strong&gt;：需要 gRPC-Web 代理&lt;/li&gt;
&lt;li&gt;❌ &lt;strong&gt;调试困难&lt;/strong&gt;：二进制格式不可直接阅读&lt;/li&gt;
&lt;li&gt;❌ &lt;strong&gt;学习曲线&lt;/strong&gt;：需要学习 Protocol Buffers 和 gRPC 概念&lt;/li&gt;
&lt;li&gt;❌ &lt;strong&gt;工具链依赖&lt;/strong&gt;：需要 protoc 编译器和各语言插件&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="10-最佳实践"&gt;10. 最佳实践
&lt;/h2&gt;&lt;h3 id="101-错误处理"&gt;10.1 错误处理
&lt;/h3&gt;&lt;p&gt;gRPC 定义了标准错误码：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;错误码&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;OK&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;成功&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;CANCELLED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;操作被取消&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;UNKNOWN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;未知错误&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;INVALID_ARGUMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;无效参数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;DEADLINE_EXCEEDED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;超时&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;NOT_FOUND&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;资源不存在&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;ALREADY_EXISTS&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;资源已存在&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;PERMISSION_DENIED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;权限不足&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;UNAUTHENTICATED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;未认证&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;RESOURCE_EXHAUSTED&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;资源耗尽&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;UNAVAILABLE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;服务不可用&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="102-性能优化建议"&gt;10.2 性能优化建议
&lt;/h3&gt;&lt;pre class="mermaid"&gt;
flowchart LR
subgraph Optimizations["性能优化"]
O1["连接复用"]
O2["流式传输大数据"]
O3["合理设置 Deadline"]
O4["启用压缩"]
O5["连接池管理"]
end
O1 --&gt; R1["减少 TCP 握手开销"]
O2 --&gt; R2["避免大消息阻塞"]
O3 --&gt; R3["防止资源泄漏"]
O4 --&gt; R4["减少网络传输"]
O5 --&gt; R5["提高并发性能"]
&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="11-参考链接"&gt;11. 参考链接
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a class="link" href="https://grpc.io/docs/" target="_blank" rel="noopener"
&gt;gRPC 官方文档&lt;/a&gt; — 官方完整文档&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://protobuf.dev/" target="_blank" rel="noopener"
&gt;Protocol Buffers 官方文档&lt;/a&gt; — Google Protocol Buffers&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/grpc/grpc" target="_blank" rel="noopener"
&gt;gRPC GitHub 仓库&lt;/a&gt; — 源码和 Issue 追踪&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/grpc/grpc-web" target="_blank" rel="noopener"
&gt;gRPC-Web&lt;/a&gt; — 浏览器端 gRPC 支持&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://datatracker.ietf.org/doc/html/rfc7540" target="_blank" rel="noopener"
&gt;HTTP/2 RFC 7540&lt;/a&gt; — HTTP/2 协议规范&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://grpc.io/docs/guides/benchmarking/" target="_blank" rel="noopener"
&gt;gRPC 性能基准测试&lt;/a&gt; — 官方性能测试指南&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;div class="admonition tip"&gt;
&lt;div class="admonition-header"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"&gt;&lt;path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/&gt;&lt;/svg&gt;
&lt;span&gt;小结&lt;/span&gt;
&lt;/div&gt;
&lt;div class="admonition-content"&gt;
&lt;p&gt;gRPC 是现代微服务架构中服务间通信的优选方案，特别适合对性能和效率有高要求的场景。如果你的系统需要跨语言、高性能、实时通信，gRPC 是值得考虑的选择。
[!summary] 前情提要&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item></channel></rss>